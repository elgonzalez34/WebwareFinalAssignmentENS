<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>A Simple Page with CKEditor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Bootstrap libraries-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!--My css file-->
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <!-- ckeditor-->
    <script src="//cdn.ckeditor.com/4.6.1/standard/ckeditor.js"></script>
    <!--Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Rokkitt|EB+Garamond" rel="stylesheet">
    <!--My scripts-->
    <script src="js/scripts.js"></script>
</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1 id="main-title">My Blog</h1>
            <p>The go-to place for all of your blogging needs</p>
        </div>
        <div class="btn-group btn-group-justified">
            <a href="#" class="btn btn-primary">All</a>
            <a href="#" class="btn btn-primary">Reviews</a>
            <a href="#" class="btn btn-primary">Previews</a>
            <a href="#" class="btn btn-primary">Essays</a>
        </div>
        <div id="post1" class="panel panel-default">
            <div class="panel-heading">Blog Post #1</div>
            <div class="panel-body">
                <form action="/addBlog" method="post" onsubmit="return false;" id="blogWriting">
                    <textarea name="editor1" id="editor1" rows="10" cols="80">
                        Blog away.
                    </textarea>
                    <!-- This script replaces the textarea with a CKEditor. It also defines the behavior for what happens
                    when the submit button is pressed. -->
                    <script>
                    //TODO This should be moved into scripts.js
                    var blogPost = '';
                    // Replace the <textarea id="editor1"> with a CKEditor
                    // instance, using default configuration.
                    var editor = CKEDITOR.replace('editor1');

                    // NOTE: Not being used right now but can be used to make things happen when typing 
                    // // The "change" event is fired whenever a change is made in the editor.
                    // editor.on('change', function(evt) {
                    //     // getData() returns CKEditor's HTML content.
                    //     blogPost += evt.editor.getData();
                    // });

                    // This function defines the behavior for what to do with the html within the CKEditor box when the submit button is pressed
                    function populate() {
                        //console.log("instances: ", CKEDITOR.instances['editor1'].getData())

                        var div = document.getElementById('blogWriting')

                        //If we wanted to trigger something when the request happens, we would do it here
                        function reqListener() {
                            //getMyList()
                        }
                        var oReq = new XMLHttpRequest();
                        // defining behavior for when the response comes back to us
                        oReq.addEventListener("load", reqListener);
                        //We need to perform the post request that will call the add blog function
                        oReq.open("POST", "/addBlog", true);
                        //We need to send the new blog post to the server
                        oReq.send('newblog=' + CKEDITOR.instances['editor1'].getData())
                    }

                    //TODO Probably should delete this, not being used at the moment
                    function getMyList() {
                        function reqListener() {
                            var tmplist = this.responseText.split(',');
                            //buildList( tmplist )
                        }
                        var oReq = new XMLHttpRequest();
                        // defining behavior for when the response comes back to us
                        oReq.addEventListener("load", reqListener);
                        oReq.open("GET", "/blogs");
                        oReq.send();
                    }
                    </script>
                    <p>
                        <input type="submit" onclick="populate();" />
                    </p>
                </form>
            </div>
        </div>
        <div id="post2" class="panel panel-default">
            <script>
            //These functions are for creating and destroying the editor box
            //TODO This should be moved into scripts.js

            var editor2, html = '';

            function createEditor() {
                if (editor2)
                    return;

                // Create a new editor instance inside the <div id="editor"> element,
                // setting its value to html.
                var config = {};
                editor2 = CKEDITOR.appendTo('editor2', config, html);

                // Update button states.
                document.getElementById('remove').style.display = '';
                document.getElementById('create').style.display = 'none';
            }

            function removeEditor() {
                if (!editor2)
                    return;

                // Retrieve the editor content. In an Ajax application this data would be
                // sent to the server or used in any other way.
                html = editor2.getData();

                // Update <div> with "Edited Content".
                document.getElementById('editorcontent2').innerHTML = html;
                // Show <div> with "Edited Content".
                document.getElementById('content2').style.display = '';
                // Update button states.
                document.getElementById('remove').style.display = 'none';
                document.getElementById('create').style.display = '';

                // Destroy the editor.
                editor2.destroy();
                editor2 = null;
            }
            </script>
            <p>
                <input onclick="createEditor();" type="button" value="Create Editor" id="create">
                <input onclick="removeEditor();" type="button" value="Remove Editor" id="remove" style="display:none">
            </p>
            <div id="editor2">
            </div>
            <div id="content2" style="display: none">
                <h3>Edited Content</h3>
                <!-- This <div> will be used to display the editor content. -->
                <div id="editorcontent2">
                </div>
            </div>
        </div>
    </div>
</body>

</html>
